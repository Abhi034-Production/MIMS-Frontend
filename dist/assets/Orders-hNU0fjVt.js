import{r as i,A as G,a as J,j as e,L as V,S as K,b as X,M as Y,l as Z,k as ee}from"./index-Ct45hBRj.js";import S from"./html2canvas.esm-BfxBtG_O.js";import{E as C}from"./jspdf.es.min-DNBeW_5t.js";const ne=()=>{const F=async()=>{const s=document.querySelector("#invoice-actions");s&&(s.style.display="none");try{const l=(await S(p.current,{scale:1.5,quality:.8,logging:!1,useCORS:!0,backgroundColor:"#FFFFFF"})).toDataURL("image/jpeg",.8),r=new C("p","mm","a5"),c=r.internal.pageSize.getWidth(),d=r.getImageProperties(l),g=d.height*c/d.width;r.addImage(l,"JPEG",0,0,c,g);const H=r.output("blob"),P=new FormData;P.append("file",H,`invoice_${n._id}.pdf`);const D=await(await fetch("https://tmpfiles.org/api/v1/upload",{method:"POST",body:P})).json();if(!D?.data?.url)throw new Error("Failed to upload PDF");const U=D.data.url.replace("tmpfiles.org/","tmpfiles.org/dl/"),q=n?.customer?.name||"Customer";let o=n?.customer?.mobile||"";o=o.replace(/\D/g,""),o.startsWith("91")||(o="91"+o);const z=`Hello ${q},

Here is your invoice from ${t?.businessName||"Our Shop"}:
${U}

Thank you for your business!`,Q=`https://wa.me/${o}?text=${encodeURIComponent(z)}`;window.open(Q,"_blank")}catch{alert("Error sharing invoice. Please try downloading and sharing manually.")}finally{s&&(s.style.display="flex")}},[I,E]=i.useState([]),[f,L]=i.useState(""),[j,w]=i.useState([]),[O,$]=i.useState(null),[m,h]=i.useState(1),[n,y]=i.useState(null),[R,N]=i.useState(!1),p=i.useRef(null),u=7,{user:x}=i.useContext(G),[t,B]=i.useState(null);i.useEffect(()=>{!x||!x.email||fetch(`https://mims-backend-x0i3.onrender.com/business-profile/${x.email}`).then(s=>s.json()).then(s=>{s.status==="success"&&B(s.profile)}).catch(()=>{})},[x]),i.useEffect(()=>{!t||!t.businessEmail||J.get(`https://mims-backend-x0i3.onrender.com/bills?businessEmail=${encodeURIComponent(t.businessEmail)}`).then(s=>{const a=s.data.sort((l,r)=>new Date(r.billDate)-new Date(l.billDate));E(a),w(a)}).catch(s=>console.error("Error fetching:",s))},[t]);const A=()=>{const s=I.filter(a=>a.customer.name.toLowerCase().includes(f.toLowerCase()));w(s),h(1),$(s.length>0?s[0]._id:null)},M=s=>{y(s),N(!1);const a=new Image;a.src=t?.businessLogo?`https://mims-backend-x0i3.onrender.com${t.businessLogo}`:"Please upload a logo";const l=new Image;l.src=t?.businessStamp?`https://mims-backend-x0i3.onrender.com${t.businessStamp}`:"Please upload a stamp",Promise.all([new Promise(r=>{a.onload=r}),new Promise(r=>{l.onload=r})]).then(()=>{N(!0)})},k=()=>{y(null)},T=()=>{if(!R){alert("Images are still loading. Please try again in a moment.");return}const s=document.querySelector("#invoice-actions");s&&(s.style.display="none"),setTimeout(async()=>{try{const l=(await S(p.current,{scale:1.5,quality:.8,logging:!1,useCORS:!0,backgroundColor:"#FFFFFF"})).toDataURL("image/jpeg",.8),r=new C("p","mm","a5"),c=r.internal.pageSize.getWidth(),d=r.getImageProperties(l),g=d.height*c/d.width;r.addImage(l,"JPEG",0,0,c,g),r.save(`Invoice_${n._id}.pdf`)}catch{alert("Error generating PDF")}finally{s&&(s.style.display="flex"),k()}},200)},v=m*u,_=v-u,W=j.slice(_,v),b=Math.ceil(j.length/u);return e.jsxs(V,{children:[e.jsx(K,{title:"Orders | easyinventory",description:"View and manage all customer orders in easyinventory. Download invoices, share via WhatsApp, and keep track of your business.",keywords:"orders, invoices, billing, customer orders, easyinventory",canonical:"/orders",url:"https://easyinventory.online/orders"}),e.jsx("div",{className:"text-sm text-gray-600 mb-4 dark:text-white",children:e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx(X,{to:"/home",children:e.jsx(Y,{fontSize:20})}),e.jsx("span",{className:"text-gray-400 dark:text-white",children:"/"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-white",children:"Orders"})]})}),e.jsxs("div",{className:"p-6 min-h-screen bg-gray-50 dark:bg-gray-900 dark:text-white transition-colors",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-center gap-4",children:[e.jsx("input",{type:"search",className:"w-full sm:w-auto border border-gray-300 rounded-md px-4 py-2 dark:bg-gray-900 dark:text-white dark:border-gray-600",placeholder:"Search Customer Name...",value:f,onChange:s=>L(s.target.value)}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white text-2xl px-4 py-2 rounded-md",onClick:A,children:e.jsx(Z,{})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-2 mb-6 mt-6 sm:p-0 transition-colors",children:e.jsxs("table",{className:"w-full text-center text-[10px] xs:text-xs sm:text-sm md:text-base table-fixed break-words",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-2 sm:px-2 sm:py-4 dark:text-white whitespace-normal",children:"Customer Name"}),e.jsx("th",{className:"px-1 py-2 sm:px-2 dark:text-white whitespace-normal",children:"Products"}),e.jsx("th",{className:"px-1 py-2 sm:px-2 dark:text-white whitespace-normal",children:"Total Price"}),e.jsx("th",{className:"px-1 py-2 sm:px-2 dark:text-white whitespace-normal",children:"Date"}),e.jsx("th",{className:"px-1 py-2 sm:px-2 dark:text-white whitespace-normal",children:"Invoice"})]})}),e.jsx("tbody",{children:W.map(s=>e.jsxs("tr",{className:O===s._id?"bg-blue-50 dark:bg-blue-900 text-center border-b":"text-center border-b",children:[e.jsx("td",{className:"py-1 px-1 sm:px-2 capitalize whitespace-normal break-words",children:s.customer.name}),e.jsx("td",{className:"py-1 px-1 sm:px-2 text-left whitespace-normal break-words",children:e.jsx("ul",{className:"list-decimal pl-4",children:s.order.map((a,l)=>e.jsxs("li",{className:"dark:text-white",children:[a.productName," (x",a.quantity,") - ₹",a.price]},l))})}),e.jsxs("td",{className:"py-1 px-1 sm:px-2 text-blue-600 font-semibold whitespace-normal break-words",children:["₹",s.total]}),e.jsx("td",{className:"py-1 px-1 sm:px-2 whitespace-normal break-words",children:new Date(s.billDate).toLocaleString()}),e.jsx("td",{className:"py-1 px-1 sm:px-2 whitespace-normal break-words",children:e.jsx("button",{onClick:()=>M(s),children:e.jsx(ee,{className:"text-blue-600 text-xl"})})})]},s._id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-6 dark:text-white",children:[e.jsx("button",{onClick:()=>h(s=>Math.max(s-1,1)),disabled:m===1,className:"px-4 py-2 bg-gray-300 dark:bg-gray-700 dark:border dark:border-gray-600 rounded disabled:opacity-50 dark:text-white transition-colors",children:e.jsx("span",{className:"dark:text-white",children:"Previous"})}),e.jsxs("span",{className:"text-sm font-semibold dark:text-white",children:["Page ",m," of ",b]}),e.jsx("button",{onClick:()=>h(s=>Math.min(s+1,b)),disabled:m===b,className:"px-4 py-2 bg-gray-300 dark:bg-gray-700 dark:border dark:border-gray-600 rounded disabled:opacity-50 dark:text-white transition-colors",children:e.jsx("span",{className:"dark:text-white",children:"Next"})})]}),n&&e.jsx("div",{className:"fixed inset-0 w-1/2 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:text-black text-black p-4 rounded shadow-lg w-full max-w-[850px] max-h-[90vh] overflow-auto",children:[e.jsxs("div",{ref:p,className:"p-4",children:[e.jsx("style",{children:`
                  body {
                    font-family: 'Helvetica', Arial, sans-serif;
                    background-color: #f8e1e1;
                    margin: 0;
                    padding: 0;
                  }
                  
                  th {
                    background-color: #d32f2f;
                    color: #fff;
                  }
                `}),e.jsxs("div",{className:"max-w-[800px] mx-auto bg-white p-6 rounded-lg shadow-lg font-sans",children:[e.jsxs("div",{className:"text-center border-b-2 border-[#f0b8b8] pb-4 mb-6",children:[e.jsxs("div",{className:"flex flex-row-reverse w-full p-2",children:[e.jsx("div",{className:"w-9/12",children:e.jsx("h1",{className:"text-10xl font-extrabold text-center my-2 text-[26px] text-[#d32f2f]",children:t?.businessName||"Business Name"})}),e.jsx("div",{className:"w-3/12 flex items-center",children:e.jsx("img",{className:"block m-auto -top-4 w-full h-full",src:t?.businessLogo?`https://mims-backend-x0i3.onrender.com${t.businessLogo}`:"Please upload a logo",alt:"Business Logo"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"my-1 text-[#444]",children:t?.businessAddress||"Business Address"}),e.jsxs("p",{className:"my-1 text-[#444]",children:["Phone: ",t?.businessMobile||""," | Email: ",t?.businessEmail||""]})]})]}),e.jsxs("div",{className:"w-[48%]",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Invoice Number:"})," INV-",n._id.slice(-6).toUpperCase()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(n.billDate).toDateString()]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"hidden",children:[e.jsx("strong",{children:"Due Date:"})," ",new Date(new Date(n.billDate).getTime()+7*864e5).toDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Terms:"})," Payment Receipt"]})]})]}),e.jsx("div",{className:"flex justify-between mb-6 ",children:e.jsxs("div",{children:[e.jsx("p",{className:"my-1 text-[#444]",children:e.jsx("strong",{children:"Customer Details:"})}),e.jsx("p",{className:"my-1 text-[#444]",children:n.customer.name}),e.jsxs("p",{className:"my-1 text-[#444]",children:["Email: ",n.customer.email]}),e.jsxs("p",{className:"my-1 text-[#444]",children:["Mobile: ",n.customer.mobile]})]})}),e.jsxs("table",{className:"w-full border-collapse mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Total"})]})}),e.jsx("tbody",{children:n.order.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-[#f0b8b8] p-2 text-left",children:s.productName}),e.jsx("td",{className:"border border-[#f0b8b8] p-2 text-left",children:s.quantity}),e.jsxs("td",{className:"border border-[#f0b8b8] p-2 text-left",children:["₹",s.price]}),e.jsxs("td",{className:"border border-[#f0b8b8] p-2 text-left",children:["₹",s.totalPrice]})]},a))})]}),e.jsx("div",{className:"text-right font-bold text-[16px] text-[#b71c1c] mt-2",children:e.jsxs("p",{children:["Total: ₹",n.total]})}),e.jsxs("div",{className:"text-center  text-[13px] text-[#666] border-t border-[#f0b8b8] pt-4 flex flex-col md:flex-row justify-between mt-0 items-center",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{children:["Thank you for shopping at ",t?.businessName||"Business Name","!"]}),e.jsx("p",{children:"Terms: All sales are final. Contact us for warranty details."})]}),e.jsx("div",{className:"text-center mt-5",children:e.jsx("img",{className:"w-24 h-24 md:w-32 md:h-32 object-contain max-w-[120px] my-[10px]",src:t?.businessStamp?`https://mims-backend-x0i3.onrender.com${t.businessStamp}`:"Please upload a stamp",alt:"Shop Stamp"})})]})]})]}),e.jsxs("div",{id:"invoice-actions",className:"flex flex-wrap justify-end gap-3 mt-4 p-4 sticky bottom-0 bg-white",children:[e.jsx("button",{onClick:T,className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:"Download PDF"}),e.jsx("button",{onClick:F,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Share via WhatsApp"}),e.jsx("button",{onClick:k,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"Close"})]})]})})]})]})};export{ne as default};
